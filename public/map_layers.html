
<html ng-app="modelo" >
	<head>
		<title>Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
   <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
   <script src="https://code.angularjs.org/1.5.7/angular-route.min.js"></script>
   <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
   <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
   <script src="modulo_mapa.js"></script>
   <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">

   <style>
      


      #map2 {
          height: 100%;
          
      }

      #nav_bar{
      padding-right: 0px;

      }

      #mapa{
    padding-left: 0px;

      }

  .navbar.navbar-default{

  height: 100%;

  }




   </style>
	</head>
	<body ng-controller="MapController">

<div class="row">	
		<div class="col-md-2" id="nav_bar">
	<nav class="navbar navbar-default" role="navigation">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand">OPCIONES</a>
    
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse navbar-ex1-collapse">
    
    
    <ul class="nav navbar-nav navbar-left">
    <br>
    <br>
    
      <li><label >Recicladoras <input type="checkbox"></label></li><br>
        <li><label >Negocios <input type="checkbox"></label></li><br>
          <li><label >Acopios <input type="checkbox"></label></li><br>
     
      
    </ul>
  </div><!-- /.navbar-collapse -->
</nav>
		</div>

		<div class="col-md-10" id="mapa" >
    <div id="map2"></div>
		
		</div>



   
	
</div>



	
 


	<script>
		var map = L.map('map2').setView([-0.181451, -78.480030], 16);


  		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamExOTc5IiwiYSI6ImNpazcyZHFtcjAxOGJ2ZGt0NGNhamQ1cXQifQ.Kkz4bJY_fOE6PM9YaWzJIg', {
      attribution: 'Map data &copy; <a href="http://openo streetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets'
  }).addTo(map);








modulo.controller('MapController',['$scope',function($scope) {


 $scope.openProfile = function(feature) {
 window.location.href="profile.html"
  
  $scope.currentWastePicker = feature.properties;
 
  console.log(feature.properties);
 
  localStorage.setItem("foto",feature.properties["waste_picker-image_url"]);
  localStorage.setItem("nombre",feature.properties["waste_picker-name"]);
  localStorage.setItem("mensaje",feature.properties["waste_picker-message"]);
  localStorage.setItem("horario",feature.properties["schedule"]);
  localStorage.setItem("asociacion",feature.properties["affiliation-name"]);
  localStorage.setItem("info_adicional",feature.properties["waste_picker-background"]);
  localStorage.setItem("edad",feature.properties["waste_picker-birth_date"]);
  localStorage.setItem("tiempo_Reci",feature.properties["waste_picker-start_date"]);

 



 
};

    function style(feature) {
      return {color: feature.properties.color,
              weight: feature.properties.weight,
              opacity: feature.properties.opacity};
    }



    function onEachFeature(feature, layer) {
        // does this feature have a property named popupContent?
        if (feature.properties && feature.properties.schedule) {
          var container = $('<div/>');
    // Delegate all event handling for the container itself and its contents to the container
    container.on('click', '.profile-link', function() {
      
    $scope.openProfile(feature);
     
    
   

    });
            container.html("<div class='map-popup' ng-app='modelo' ui-sref='profile'>" +
                "<a class='profile-link' href='#'>" +
                "<div class='centered'><img class='wastepickerpic' src='" + feature.properties["waste_picker-image_url"] + "'/></div>" +
                "<div class='text-center' style='color: " + feature.properties["color"] + "; opacity: 0.5;'>@" + feature.properties["waste_picker-name"] + "</div>" +
                "</a>" +
                "</div>");
    
    layer.bindPopup(container[0]);
        }
    }








    var routes;

   $.getJSON("http://api-reciveci.rhcloud.com/map/routes.json", function(data) {

      routes = data ;
     
      L.geoJson(routes, {style: style, onEachFeature: onEachFeature}).addTo(map);
    });








var business;

   $.getJSON("http://localhost:5000/map/business.json", function(data) {

      business = data ;
      console.log(business);
      L.geoJson(business, {style: style, onEachFeature: onEachFeature}).addTo(map);
    });









var affiliations
   $.getJSON("http://localhost:5000/map/affiliations.json", function(data) {

      affiliations = data ;
      console.log(affiliations);
      L.geoJson(affiliations, {style: style, onEachFeature: onEachFeature}).addTo(map);
    });









}])
	</script>
		
	</body>
</html>